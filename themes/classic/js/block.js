// TODO Когда появятся готовые блоки в позициях переделать функцию show_hidePosition()// Открываем/Закрываем позиции для редактированияfunction show_hidePosition(obj){    var name_position    if(!obj.hasClass("showed")){        obj.addClass("showed");        $(".site_position").each(function(){            name_position = $(this).attr('id');            $("#"+name_position).sortable({disabled: false, handle:'.show_block_info',                update: function(event, ui){                     $(".tooltip").remove();                    save_position(this);                }})            $(this).show().css("box-shadow","0px 0px 3px blue ");            if ($(this).find(".site_block_item").length) $(this).find(".show_block_info").show();            $(this).css("min-height","30px");            $(this).find(".show_admin_position_panel").show();        });    }    else{        obj.removeClass("showed");        $(".site_position").each(function(){            name_position = $(this).attr('id');            $("#"+name_position).sortable({items: '.site_block_item', disabled: true})            if (!$(this).find(".site_block_item").length) $(this).hide();            else{                $(this).find(".show_block_info").hide();                $(this).find(".show_admin_position_panel").hide();            }            $(this).css("box-shadow","0px 0px 0px blue inset");        })    }}function save_position(element){    var position = ($(element).closest('.site_position').attr('id')).slice(8);    var blocks = $(element).closest('.site_position').find(".bar")    var blocks_id_arr = new Array;    blocks.each(function(index, domEle){            blocks_id_arr[index] = $(domEle).attr('title');    });    $.ajax({            url: getLangPrefix()+'backend/blocks',            data: {'submit_save_stack':'Сохранить последовательность блоков в позиции', 'blocks[id_array]':blocks_id_arr, 'url':$(location).attr('href'),'position_id':position},            type: 'post',            dataType: 'json',            success: function (json) {                if(json.status == "success"){                        $("#msg-box").html("<div class='alert alert-success fade in'>"+json.msg+"</div>").fadeIn();                        setTimeout('clearMsgBox()', 1000);                }            }    })}// Открываем всплывающее окно со списком блоков на данной странице в данной позицииfunction showPositionIndex(obj){    var lnk = $(location).attr('href');    var url = getLangPrefix()+"backend/blocks?position="+obj.parent().attr('id');    openCenteredWindow(url, "PositionIndex");}function refindBlockPattern(resetSelected){   var block_type = $("#block_type").val(); var block_types;   if(resetSelected) $("#block_pattern option").removeClass("hidden").removeAttr("disabled").removeAttr("selected");   if(block_type && block_type != 0){       $("#block_pattern option").each(function(){           if($(this).data("blocktypes")){               block_types = $(this).data("blocktypes").split(', ');                if(!in_array(block_type, block_types)) $(this).addClass("hidden").attr("disabled","disabled");                }})}   else {       $("#block_pattern option").addClass("hidden").attr("disabled","disabled");   }   if(!$("#block_pattern option:first").length)$("#block_pattern option:first").removeClass("hidden").removeAttr("disabled").attr("selected","selected");    //if(resetSelected)$("#block_pattern option:first").removeClass("hidden").removeAttr("disabled").attr("selected","selected");    else $("#block_pattern option[selected=selected]").removeClass("hidden").removeAttr("disabled");    reloadMaterials();}function reloadMaterials(){   var str= "";   var block_type = $("#block_type").val();   var block_pattern = $("#block_pattern").val();   if($("#id").length) str += "?id="+$("#id").val();   if(block_type == 0 && block_pattern == 0){$("#materials").html("<div class='alert alert-error'>Выберите тип и шаблон блока</div>");return;}   if(block_type == 0){$("#materials").html("<div class='alert alert-error'>Выберите тип блока</div>");return;}   if(block_pattern == 0){ $("#materials").html("<div class='alert alert-error'>Выберите шаблон блока</div>"); return;}   $.get('block'+block_type+'.html'+str, function(data) {       $("#materials").html(data);       loadForSample();   });}// На индексной странице блоков действие "Сохранить""function loadForSample(){    if($(".sample_select .sample:checked").length){    var block_type = $("#block_type").val();    var block_id = $("#id").val();    var sample = $(".sample_select .sample:checked").val();    $.get('block'+block_type+'.html?getforsample='+sample+'&id='+block_id, function(data) {       $("#select-materials").html(data);        });    }}function changeChildStatus(obj){    if(!obj.is(":checked")){        obj.removeAttr("checked");        obj.parent().find(".blockmenumaterialswrap .blockmenumaterial").removeAttr("checked");    }}function changeParentStatus(obj){    if(obj.is(":checked")){        obj.closest(".menuitem").find(".menuitem-input").prop("checked", true);    }}function loadSectionsMaterials(){    var section_arr = new Array();    var block_type = $("#block_type").val();    if($("#select-materials .sections-wrap .one_section:checked").length){        $("#select-materials .sections-wrap .one_section:checked").each(function(){            section_arr.push($(this).val());        })        if(section_arr[0]){            $.get(getLangPrefix()+'block'+block_type+'.html?getmaterialforsections='+section_arr.join(),                 function(data) {                var mat_list = $("<ul></ul>").html(data);                $("#select-materials .meterials-wrap .material_box").each(function(){                    var rel_attr = $(this).attr("rel");                    if(!$(mat_list).find(".material_box[rel="+rel_attr+"]").length){                        $(this).remove();                    }                })                $(mat_list).find(".material_box").each(function(){                    var rel_attr = $(this).attr("rel");                    if(!$("#select-materials .meterials-wrap .material_box[rel="+rel_attr+"]").length){                        $(this).appendTo("#select-materials .meterials-wrap");                    }                })                $("#select-materials .meterials-wrap").sortable();            });        }    }    else{        $("#select-materials .meterials-wrap").empty();    }}$(document).ready(function(){    $(".show_block_info").hover(function(){        var site_block_item = $(this).closest(".site_block_item");        $("<div class='site_block_item_overlay'></div>").appendTo(site_block_item).show(500);    },function(){        var site_block_item = $(this).closest(".site_block_item");        site_block_item.find(".site_block_item_overlay").remove();    });})